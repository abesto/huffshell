#!/usr/bin/env ruby

require 'huffshell'
require 'colorize'

cs = CommandSuggestor.new

# TODOS
# get largest history file
# examine to see what format the file is in
# let users tell me where their files is

files = ['~/.zsh_history', '~/.zshhistory', '~/.zhistory']
history_filename = files.map{|f| File.expand_path(f) }.select{|f| File.exist?(f) }.first

puts "Huffshel"
puts "============="
puts ["History found:", history_filename, File.size(history_filename).to_s].join(" ")

OhMyZshReader.new(history_filename).
  shell_commands.
  each{ |l| cs.add(l) }

puts ""
puts "============="
puts [cs.commands.size.to_s.green, "unique keywords"].join(" ")

puts ""
[250, 100, 50, 20, 10, 5, 2, 1].reverse.each do |count|
  puts [cs.wordtree.root.minimum(count).keys.size.to_s.green, "commands appear > #{count} times"].join(" ")
end

puts ""
puts "Most common commands:"

cs.wordtree.root.minimum(10).sort{|a, b| a[1].line_count <=> b[1].line_count }.reverse[0,10].each do |word, node|
  puts [node.word, node.line_count.to_s.green].join(" ")
end

cs.truncate!(30)

puts ""
puts "Command tree:"
puts cs.to_print
